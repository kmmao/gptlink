import{j as J,r as n,q as ae,A as oe,C as T,D as p,G as l,B as x,E as e,F as i,_ as K,an as ne,O as I,a6 as q,a2 as r,R as G,I as S,aM as u,L as le,ag as ie,aa as de,W as re,ak as ce,a5 as ue,aH as y,aN as pe,ad as xe,aO as me,a7 as $,a3 as V,ao as ve,am as H,al as _e,X as ge,Y as fe,S as ye}from"./index-4d4f77ba.js";import{g as he}from"./index-31c42854.js";import{H as we}from"./index-a406ca27.js";import{N as be}from"./InputGroup-cf6cbeff.js";const ke={class:"bg-white w-11/12 sm:w-96 pb-6 rounded-lg"},Ie={class:"text-xl text-[#4f555e] dark:text-white"},Be=e("div",{class:"text-lg text-center py-2"}," 充值记录 ",-1),Ce={class:"py-2 px-2 w-full"},$e={class:"overflow-x-auto"},Se={class:"inline-block min-w-full py-2 align-middle"},Oe={class:"overflow-hidden shadow ring-1 ring-black ring-opacity-5"},Me={class:"w-full divide-y divide-gray-300"},Le=e("thead",{class:"bg-black"},[e("tr",null,[e("th",{scope:"col",class:"whitespace-nowrap text-center py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-white sm:pl-6"}," 名称 "),e("th",{scope:"col",class:"whitespace-nowrap text-center px-3 py-3.5 text-left text-sm font-semibold text-white"}," 问答机会 "),e("th",{scope:"col",class:"whitespace-nowrap text-center px-3 py-3.5 text-left text-sm font-semibold text-white"}," 日期 ")])],-1),Re={class:"divide-y divide-gray-200 bg-white"},Ne={class:"py-4 pl-4 pr-3 text-xs text-center font-medium text-gray-900 align-middle"},We={class:"px-3 py-4 text-xs text-center text-gray-500 align-middle"},Pe={class:"px-3 py-4 text-xs text-center text-gray-500 align-middle"},Ue=J({__name:"Bill",props:{visible:{type:Boolean}},emits:["update:visible"],setup(f,{emit:h}){const m=f,w=n([]),c=ae({get(){return m.visible},set(v){h("update:visible",v)}});oe(()=>c.value,()=>{c.value&&b()});const b=async()=>{const v=await u.getUserRecord();w.value=v};return(v,d)=>(x(),T(l(S),{show:c.value,"onUpdate:show":d[1]||(d[1]=o=>c.value=o),"auto-focus":!1},{default:p(()=>[e("div",ke,[i(l(ne),{tooltip:"关闭",class:"absolute top-0 right-0",onClick:d[0]||(d[0]=o=>c.value=!1)},{default:p(()=>[e("span",Ie,[i(l(K),{icon:"material-symbols:close"})])]),_:1}),Be,e("div",Ce,[e("div",$e,[e("div",Se,[e("div",Oe,[e("table",Me,[Le,e("tbody",Re,[(x(!0),I(G,null,q(w.value,o=>(x(),I("tr",{key:o.id},[e("td",Ne,r(o.package_name),1),e("td",We," +"+r(o.num===-1?`${o.expired_day}天`:`${o.num}次`),1),e("td",Pe,r(o.created_at),1)]))),128))])])])])])])])]),_:1},8,["show"]))}}),O=f=>(ge("data-v-071dff03"),f=f(),fe(),f),Te={class:"bg-white h-page xl:pt-10"},Ee={class:"mx-auto max-w-7xl py-12 pt-2 px-6"},Ae={class:"sm:grid sm:grid-cols-2 sm:gap-6 sm:space-y-0 lg:mx-auto lg:max-w-4xl xl:mx-0 sm:max-w-none xl:max-w-none xl:grid-cols-4 flex flex-wrap justify-between xs:block"},De={class:"p-4 text-center sm:p-6"},Ve={class:"text-lg font-medium leading-6 text-gray-900 h-12"},He={class:"mt-4 sm:mt-8"},Je={class:"font-bold tracking-tight text-gray-900 text-2xl sm:text-4xl"},Ke=O(()=>e("span",{class:"text-base font-medium text-gray-500"},"元",-1)),qe={class:"text-sm h-6 text-red-500"},Ge=["href","onClick"],Qe={class:"my-6"},je={class:"px-6 pt-6 pb-8"},ze={class:"text-sm font-medium text-gray-900 flex items-center justify-between"},Fe={class:"flex items-center"},Xe=O(()=>e("ul",{role:"list",class:"mt-6 space-y-4"},[e("li",{class:"flex space-x-3"}," 1.账户充值仅限微信在线支付方式，充值金额实时到账 "),e("li",{class:"flex space-x-3"}," 2.账户有效次数自充值日起至用完为止 ")],-1)),Ye={class:"bg-white w-5/6 xl:w-2/5 sm:w-3/5 pb-6 rounded-lg"},Ze=["innerHTML"],et={class:"bg-white w-5/6 xl:w-2/5 sm:w-3/5 pb-6 rounded-lg"},tt=O(()=>e("div",{class:"mx-auto text-2xl max-w-5xl pt-6 sm:px-6 lg:px-8 text-center"}," 套餐已到账 ",-1)),st={class:"text-xl max-w-5xl py-6 sm:px-6 lg:px-8 text-center"},at={class:"text-center"},ot={class:"bg-white w-5/6 sm:w-2/5 pb-20 rounded-lg"},nt=O(()=>e("div",{class:"text-2xl max-w-5xl pt-6 sm:px-6 lg:px-8 text-center"}," 微信扫码 ",-1)),lt={class:"text-xl max-w-5xl py-6 sm:px-6 lg:4px-8 text-center"},it=J({__name:"index",setup(f){const h=n(null),m=n(!0),w=n([]),c=n(null),b=le(),{query:v}=ie(),d=de(),{isMobile:o}=re();let _=null;const k=n(""),M=n(null),B=n(!1),C=n(!1),L=n(null),R=n(!1),N=n({}),W=n(!1),E=()=>/MicroMessenger/i.test(window.navigator.userAgent),Q=async()=>{try{const s=await u.getPackageList();w.value=s}catch{}},j=async()=>{try{const s=await u.getPaymentConfig();N.value=s}catch{}},P=()=>{y.set("levelDomainBusinessId",null),window.history.length>2?b.back():b.replace({name:"Root"})},A=()=>{_&&(_.destroy(),_=null)},D=s=>{if(window.WeixinJSBridge&&s){const{appId:a,timeStamp:t,nonceStr:g,signType:Z,paySign:ee}=s,te={appId:a,timeStamp:t,nonceStr:g,signType:Z,paySign:ee,package:s.package};window.WeixinJSBridge.invoke("getBrandWCPayRequest",te,se=>{se.err_msg==="get_brand_wcpay_request:ok"&&(d.success("套餐购买成功",{duration:600}),setTimeout(()=>{P()},1e3)),m.value=!0,A()})}},U=()=>{C.value=!1,clearInterval(h.value),h.value=null},z=async s=>{h.value=setInterval(async()=>{(await u.getOrderStatus({id:s})).status===2&&(U(),d.success("套餐购买成功",{duration:600}),setTimeout(()=>{P()},1e3))},1e3*2)},F=async s=>{if(l(N).channel==="offline"){W.value=!0;return}if(m.value){m.value=!1,_=d.loading("支付中...",{duration:0}),c.value=s;const a=y.get("userKeyOpenId");try{const t=await u.createOrder({package_id:s.id,channel:"wechat",pay_type:E()&&o.value?"JSAPI":"NATIVE",user_id:a||"",platform:1,business_id:y.get("levelDomainBusinessId")}),g=await u.orderPay({id:t.id});E()&&o.value?typeof window.WeixinJSBridge>"u"?document.addEventListener&&document.addEventListener("WeixinJSBridgeReady",D(g.data)):D(g.data):g.err_code||(L.value=g,C.value=!0,A(),z(t.id))}catch{m.value=!0,_&&(_.destroy(),_=null)}}else setTimeout(()=>{m.value=!0},400)};ce(()=>{U()});const X=async()=>{if(!k.value)return d.error("请先输入正确兑换码");try{const s=await u.cdkExchange({cdk:k.value});s.err_code||(M.value=s,B.value=!0)}catch{}},Y=()=>{B.value=!1,k.value=""};return ue(async()=>{if(v.businessid){y.set("levelDomainBusinessId",v.businessid),b.replace({path:"/redirect/combo"});return}j(),Q();const s=he("code");if(!(pe("userKeyOpenId")||y.get("userKeyOpenId"))&&s)try{const t=await u.getWechatOpenId({code:s,type:xe()&&o.value?"weixin":"weixinweb"});y.set("userKeyOpenId",t.user),me("userKeyOpenId",t.user)}catch{}}),(s,a)=>(x(),I("div",Te,[i(l(we),{"custom-back":P,title:"套餐"}),e("div",Ee,[e("div",Ae,[(x(!0),I(G,null,q(w.value,t=>(x(),I("div",{key:t.id,class:"divide-y divide-gray-200 rounded-lg border border-gray-200 shadow-sm w-48-100 sm:w-auto mb-4 sm:mb-0"},[e("div",De,[e("h2",Ve,r(t.name),1),e("p",He,[e("span",Je,r(t.price),1),$(" "+r(" ")+" "),Ke]),e("div",qe,r(t.identity===2?"开发者专享":""),1),e("a",{href:t.href,class:"mt-2 block w-full rounded-md border border-gray-800 bg-gray-800 py-2 text-center text-sm font-semibold text-white hover:bg-gray-900",onClick:g=>F(t)}," 购买 ",8,Ge)])]))),128))]),e("div",Qe,[i(l(be),null,{default:p(()=>[i(l(ve),{value:k.value,"onUpdate:value":a[0]||(a[0]=t=>k.value=t),style:{width:"100%"},placeholder:"请输入正确的兑换码",size:"large"},null,8,["value"]),i(l(H),{type:"primary",class:"border-gray-800 !bg-gray-800",size:"large",onClick:X},{default:p(()=>[$(" 立即兑换 ")]),_:1})]),_:1})]),e("div",je,[e("h3",ze,[e("div",Fe,[i(l(K),{icon:"material-symbols:book-outline-rounded",class:"mr-2"}),$("充值说明 ")]),e("div",{class:"cursor-pointer text-gray-500",onClick:a[1]||(a[1]=t=>R.value=!0)}," 充值记录 > ")]),Xe])]),i(Ue,{visible:R.value,"onUpdate:visible":a[2]||(a[2]=t=>R.value=t)},null,8,["visible"]),i(l(S),{show:W.value,"onUpdate:show":a[3]||(a[3]=t=>W.value=t),"auto-focus":!1},{default:p(()=>[e("div",Ye,[e("div",{innerHTML:N.value.offline},null,8,Ze)])]),_:1},8,["show"]),M.value?(x(),T(l(S),{key:0,show:B.value,"onUpdate:show":a[4]||(a[4]=t=>B.value=t),"auto-focus":!1},{default:p(()=>[e("div",et,[tt,e("div",st,r(M.value.name),1),e("div",at,[i(l(H),{type:"primary",style:{width:"90px"},strong:"",color:"#1f2937",onClick:Y},{default:p(()=>[$(" 确定 ")]),_:1})])])]),_:1},8,["show"])):V("",!0),L.value?(x(),T(l(S),{key:1,show:C.value,"onUpdate:show":a[5]||(a[5]=t=>C.value=t),"auto-focus":!1,"on-after-leave":U},{default:p(()=>[e("div",ot,[nt,e("div",lt," ￥ "+r(c.value.price),1),i(_e,{class:"mx-auto",value:L.value.data.code_url,size:220},null,8,["value"])])]),_:1},8,["show"])):V("",!0)]))}});const pt=ye(it,[["__scopeId","data-v-071dff03"]]);export{pt as default};
