import{j as P,r as m,K as T,aP as G,W as j,M as D,q as _,A as Q,B as u,C as $,D as k,E as s,F as c,G as t,_ as E,ao as F,am as U,a7 as L,H as X,al as J,O as w,a3 as z,I as K,J as W,ac as Y,X as M,Y as O,af as Z,S as R,L as ee,a5 as te,a2 as g,R as se,a6 as ae,aM as oe,aQ as ne,P as A,Q as le}from"./index-4d4f77ba.js";import{c as re}from"./index-31c42854.js";import{N as ce}from"./InputGroup-cf6cbeff.js";import{H as ie}from"./index-a406ca27.js";import{T as ue}from"./index-494f9065.js";const de="/assets/poster-34c80d2f.png",V=l=>(M("data-v-f2c343f1"),l=l(),O(),l),pe={class:"share-body w-full flex flex-col items-center justify-center"},fe={class:"text-xl text-[white]"},me=V(()=>s("div",{class:"text-base text-[white] text-center mb-2"}," 专属邀请链接 ",-1)),_e={class:"flex justify-center"},ve={id:"poster",class:"poster bg-white overflow-hidden"},he=["src"],xe=["src"],ye=V(()=>s("div",{class:"w-3/6 text-sm text-[white] text-center mt-2"}," 保存上方图片，分享你专属海报给朋友 ",-1)),be=P({__name:"index",props:{visible:{type:Boolean},data:{},type:{}},emits:["update:visible"],setup(l,{emit:S}){const i=l,v=m(""),p=m(""),I=T(),{shareCallback:C}=G(),{isPrivateDomain:f}=j(),{domainConfig:y}=D(),h=_(()=>{var o;return((o=I.authInfo)==null?void 0:o.user)||{}}),b=_(()=>i.data||{}),d=_({get(){return i.visible},set(o){S("update:visible",o)}}),N=_(()=>{const{openid:o}=h.value,{type:r}=t(i);return`${window.location.origin}${r==="distribution"?"/distribution/apply":""}${o?`/?shareOpenId=${o}`:""}`});Q(()=>d.value,async()=>{if(d.value){const{openid:o}=h.value,{type:r}=t(i);try{p.value=`${window.location.origin}${r==="/distribution"?"/distribution/apply":""}/${o?`?shareOpenId=${o}`:""}`}catch{}W(()=>{const e=document.querySelector("#poster");Y(e,{useCORS:!0,scale:4,backgroundColor:null,ignoreElements:a=>{if(Z(a.className)&&a.className.includes("poster-img"))return!0},onclone:a=>{const{type:x}=t(i);if(x==="distribution"){const n=a.querySelector(".distibution-info");n&&(n.style.transform="translate(-50%, -6.5px)")}else if(f){const n=a.querySelector(".qrcode");n.style.transform="translateX(-13.5px)",n.style.left="50%"}}}).then(a=>{const x=a.toDataURL();v.value=x}).catch(a=>{console.log(a)})})}});function B(){d.value=!1,C(b.value.type)}function q(){re({text:p.value,dom:document.querySelector(".share-body")})}return(o,r)=>(u(),$(t(K),{show:d.value,"onUpdate:show":r[1]||(r[1]=e=>d.value=e),"auto-focus":!1},{default:k(()=>{var e;return[s("div",pe,[s("div",{class:"close-btn flex justify-center items-center p-2 cursor-pointer fixed top-0 right-0",onClick:B},[s("span",fe,[c(t(E),{icon:"material-symbols:close",style:{"font-size":"35px"}})])]),me,s("div",_e,[c(t(ce),null,{default:k(()=>[c(t(F),{value:p.value,"onUpdate:value":r[0]||(r[0]=a=>p.value=a),class:"flex-1"},null,8,["value"]),c(t(U),{type:"primary",onClick:q},{default:k(()=>[L(" 复制链接 ")]),_:1})]),_:1})]),s("div",ve,[s("img",{src:t(f)?(e=t(y))==null?void 0:e.share_img:t(de),class:"w-full h-full poster-bg"},null,8,he),c(J,{class:X(["qrcode",{qrcodeCenter:t(f)}]),value:N.value,size:50},null,8,["class","value"]),v.value?(u(),w("img",{key:0,src:v.value,class:"w-full h-full poster-img"},null,8,xe)):z("",!0)]),ye])]}),_:1},8,["show"]))}}),ge=R(be,[["__scopeId","data-v-f2c343f1"]]),we=l=>(M("data-v-e91ba9fe"),l=l(),O(),l),ke={class:"bg-white min-h-screen"},$e={class:"mx-auto w-11/12 sm:w-96"},Se={class:"pt-8"},Ie={class:"mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 flex items-center"},Ce={class:"sm:flex sm:items-end sm:space-x-5 justify-center"},Ne={class:"flex justify-center"},Be={class:"flex-1 flex items-center userinfo"},qe={class:"flex-1 px-2"},Ue={class:"truncate font-bold text-gray-900"},Le={class:"mx-4 flex items-center px-4 py-2 sm:px-6 lg:px-8 mt-6 bg-white shadow-2xl rounded-lg",style:{"--tw-shadow":"0 0px 15px -7px rgb(0 0 0 / 0.5)"}},ze={class:"flex items-center flex-1 mr-4 py-2 text-gray-600"},Ae={key:0,class:"px-4 sm:px-6 lg:px-8 mt-4"},Pe=we(()=>s("div",{class:"font-semibold"}," 任务中心 ",-1)),Te={class:"flex items-center"},je={class:"flex-1 text-base italic font-medium truncate"},De={class:"mt-1 text-xs ml-6 truncate"},Ee=P({__name:"index",setup(l){const S=ee(),i=T(),{isMobile:v}=j(),p={invite:{title:"邀请好友",btn:"立即邀请",icon:"ant-design:user-add-outlined"},share:{title:"每日分享",btn:"立即分享",icon:"material-symbols:share"}},I=D(),C=_(()=>I.webBasicInfo||{}),f=_(()=>{var e;return((e=i.authInfo)==null?void 0:e.user)||{}}),y=m([]),h=m(null),b=m(!1),d=m(null);m("");const N=_(()=>{const e=h.value||{};return Array.isArray(e)?"可用余额不足":e.num===-1?`有效期：${e.expired_at}`:`有效次数：${e.num-e.used}次`}),B=async()=>{const{authInfo:e}=i;if(e)try{const a=await oe.getUserNum();h.value=a}catch{}},q=()=>{S.push({name:"Combo"})},o=async()=>{const e=await ne.getTaskList();y.value=e.filter(a=>a.type!=="register")},r=e=>{b.value=!0,d.value=e};return te(()=>{B(),o(),i.getUserProfile()}),(e,a)=>{var x;return u(),w("div",ke,[c(t(ie),{"hide-back":t(v),title:"个人中心"},null,8,["hide-back"]),s("div",$e,[s("div",Se,[s("div",Ie,[s("div",Ce,[s("div",Ne,[f.value.avatar?(u(),$(t(A),{key:0,size:"medium",round:"",src:f.value.avatar},null,8,["src"])):(u(),$(t(A),{key:1,size:"medium",round:"",src:((x=C.value)==null?void 0:x.user_logo)||t(le)},null,8,["src"]))])]),s("div",Be,[s("div",qe,[s("h1",Ue,g(f.value.nickname??""),1)])])])]),s("div",Le,[s("div",ze,g(h.value?N.value:"可用余额不足"),1),c(t(U),{type:"primary",round:"",onClick:q},{default:k(()=>[L(" 去充值 ")]),_:1})]),y.value.length?(u(),w("div",Ae,[Pe,(u(!0),w(se,null,ae(y.value,(n,H)=>(u(),w("div",{key:H,class:"bg-black rounded-lg shadow text-white py-2 px-3 mt-2"},[s("div",Te,[c(t(E),{icon:p[n.type].icon,class:"mr-1",style:{color:"#fff","font-size":"20px"}},null,8,["icon"]),s("div",je,g(n.title),1),c(t(U),{round:"",size:"small",style:{background:"#fff"},onClick:Me=>r(n)},{default:k(()=>[L(g(p[n.type].btn),1)]),_:2},1032,["onClick"])]),s("div",De,g(n.desc),1)]))),128))])):z("",!0)]),c(t(ge),{visible:b.value,"onUpdate:visible":a[0]||(a[0]=n=>b.value=n),data:d.value},null,8,["visible","data"]),t(v)?(u(),$(t(ue),{key:0})):z("",!0)])}}});const Qe=R(Ee,[["__scopeId","data-v-e91ba9fe"]]);export{Qe as default};
